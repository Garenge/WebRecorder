<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘å¯¹æ¯”åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª è§†é¢‘å¯¹æ¯”åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>1. è„šæœ¬åŠ è½½æµ‹è¯•</h3>
        <button onclick="testScriptLoading()">æµ‹è¯•è„šæœ¬åŠ è½½</button>
        <div id="scriptTestResult"></div>
    </div>
    
    <div class="test-section">
        <h3>2. VideoComparisonHelper æµ‹è¯•</h3>
        <button onclick="testHelperClass()">æµ‹è¯•åŠ©æ‰‹ç±»</button>
        <div id="helperTestResult"></div>
    </div>
    
    <div class="test-section">
        <h3>3. åˆå§‹åŒ–æµ‹è¯•</h3>
        <button onclick="testInitialization()">æµ‹è¯•åˆå§‹åŒ–</button>
        <div id="initTestResult"></div>
    </div>
    
    <div class="test-section">
        <h3>4. å®Œæ•´åŠŸèƒ½æµ‹è¯•</h3>
        <button onclick="testFullFunction()">æµ‹è¯•å®Œæ•´åŠŸèƒ½</button>
        <div id="fullTestResult"></div>
    </div>

    <!-- FFmpeg.wasm åº“ -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/umd/ffmpeg.js"></script>
    <script src="https://unpkg.com/@ffmpeg/util@0.12.1/dist/umd/util.js"></script>
    
    <!-- åº”ç”¨è„šæœ¬ -->
    <script src="video-comparison-helper.js"></script>
    
    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            element.innerHTML += `<div class="${className}">${message}</div>`;
        }
        
        function clearLog(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }
        
        async function testScriptLoading() {
            clearLog('scriptTestResult');
            log('scriptTestResult', 'ğŸ” æ£€æŸ¥è„šæœ¬åŠ è½½çŠ¶æ€...');
            
            // æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„FFmpegå…¨å±€å˜é‡
            const ffmpegVars = ['FFmpeg', 'ffmpeg', 'FFmpegWASM', 'ffmpegWASM'];
            let ffmpegFound = false;
            
            for (const varName of ffmpegVars) {
                if (typeof window[varName] !== 'undefined') {
                    log('scriptTestResult', `âœ… ${varName} åº“å·²åŠ è½½`, 'success');
                    ffmpegFound = true;
                    break;
                }
            }
            
            if (!ffmpegFound) {
                log('scriptTestResult', 'âŒ FFmpeg åº“æœªåŠ è½½', 'error');
                log('scriptTestResult', 'ğŸ” æ£€æŸ¥windowå¯¹è±¡ä¸­çš„FFmpegç›¸å…³å˜é‡...', 'info');
                for (const key in window) {
                    if (key.toLowerCase().includes('ffmpeg')) {
                        log('scriptTestResult', `ğŸ“‹ å‘ç°: window.${key} = ${typeof window[key]}`, 'info');
                    }
                }
            }
            
            // æ£€æŸ¥FFmpegUtil
            const utilVars = ['FFmpegUtil', 'ffmpegUtil', 'FFmpegUtils', 'ffmpegUtils'];
            let utilFound = false;
            
            for (const varName of utilVars) {
                if (typeof window[varName] !== 'undefined') {
                    log('scriptTestResult', `âœ… ${varName} åº“å·²åŠ è½½`, 'success');
                    utilFound = true;
                    break;
                }
            }
            
            if (!utilFound) {
                log('scriptTestResult', 'âŒ FFmpegUtil åº“æœªåŠ è½½', 'error');
            }
            
            // æ£€æŸ¥VideoComparisonHelper
            if (typeof window.VideoComparisonHelper !== 'undefined') {
                log('scriptTestResult', 'âœ… VideoComparisonHelper ç±»å·²åŠ è½½', 'success');
            } else {
                log('scriptTestResult', 'âŒ VideoComparisonHelper ç±»æœªåŠ è½½', 'error');
            }
        }
        
        async function testHelperClass() {
            clearLog('helperTestResult');
            log('helperTestResult', 'ğŸ” æµ‹è¯• VideoComparisonHelper ç±»...');
            
            try {
                if (typeof window.VideoComparisonHelper === 'undefined') {
                    throw new Error('VideoComparisonHelper ç±»æœªå®šä¹‰');
                }
                
                const helper = new window.VideoComparisonHelper();
                log('helperTestResult', 'âœ… æˆåŠŸåˆ›å»º VideoComparisonHelper å®ä¾‹', 'success');
                
                log('helperTestResult', `ğŸ“Š å®ä¾‹çŠ¶æ€: isInitialized=${helper.isInitialized}`, 'info');
                
            } catch (error) {
                log('helperTestResult', `âŒ åˆ›å»ºå®ä¾‹å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testInitialization() {
            clearLog('initTestResult');
            log('initTestResult', 'ğŸ” æµ‹è¯•åˆå§‹åŒ–è¿‡ç¨‹...');
            
            try {
                if (typeof window.VideoComparisonHelper === 'undefined') {
                    throw new Error('VideoComparisonHelper ç±»æœªå®šä¹‰');
                }
                
                const helper = new window.VideoComparisonHelper();
                log('initTestResult', 'âœ… åˆ›å»ºåŠ©æ‰‹å®ä¾‹æˆåŠŸ', 'success');
                
                log('initTestResult', 'ğŸ”„ å¼€å§‹åˆå§‹åŒ–...', 'info');
                await helper.initialize();
                
                log('initTestResult', 'âœ… åˆå§‹åŒ–æˆåŠŸ', 'success');
                log('initTestResult', `ğŸ“Š åˆå§‹åŒ–çŠ¶æ€: ${helper.isInitialized}`, 'info');
                
            } catch (error) {
                log('initTestResult', `âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                console.error('åˆå§‹åŒ–é”™è¯¯è¯¦æƒ…:', error);
            }
        }
        
        async function testFullFunction() {
            clearLog('fullTestResult');
            log('fullTestResult', 'ğŸ” æµ‹è¯•å®Œæ•´åŠŸèƒ½...');
            
            try {
                // ç­‰å¾…FFmpegåŠ è½½
                log('fullTestResult', 'â³ ç­‰å¾…FFmpegåº“åŠ è½½...', 'info');
                let attempts = 0;
                while (attempts < 50) {
                    if (typeof window.FFmpeg !== 'undefined' && typeof window.FFmpegUtil !== 'undefined') {
                        break;
                    }
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (attempts >= 50) {
                    throw new Error('FFmpegåº“åŠ è½½è¶…æ—¶');
                }
                
                log('fullTestResult', 'âœ… FFmpegåº“åŠ è½½å®Œæˆ', 'success');
                
                // åˆ›å»ºåŠ©æ‰‹å®ä¾‹
                const helper = new window.VideoComparisonHelper();
                await helper.initialize();
                
                log('fullTestResult', 'âœ… è§†é¢‘å¯¹æ¯”åŠŸèƒ½åˆå§‹åŒ–æˆåŠŸ', 'success');
                log('fullTestResult', 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼', 'success');
                
            } catch (error) {
                log('fullTestResult', `âŒ å®Œæ•´åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                console.error('å®Œæ•´åŠŸèƒ½æµ‹è¯•é”™è¯¯è¯¦æƒ…:', error);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œè„šæœ¬åŠ è½½æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(testScriptLoading, 1000);
        });
    </script>
</body>
</html>